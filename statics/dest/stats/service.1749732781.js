!function(){"use strict";function t(t,e){function n(t){var e=[];return angular.forEach(t.split("\n"),function(t){var n=t.split("||"),a=[],r={key:n[0],type:n[1],values:a};angular.forEach(n.pop().split(","),function(t){var e=t.split("|");a.push({t:e[0],v:parseFloat(e[1])})}),e.push(r)}),e}function a(e,a){if(!e||!a)throw new Error("collection and conditions can not be null");var r=[],s=u.format;r.push("format="+s),r.push("conditions="+JSON.stringify(a));var o="/stats/collection/"+e+"?"+r.join("&"),i=t.get(o);return i.then(function(t){return"text"===s&&t.data&&(t.data=n(t.data)),t}),i}function r(t,e,n,a){angular.forEach(t,function(t){t.interval=a,t.title+="("+n+")",t.data=[]});var r=function(t){var e=0;angular.forEach(t,function(t){e+=t.v});var n=t[t.length-1];return{v:e,t:n.t}},s=function(t){var e=r(t);return e.v=Maht.ceil(e.v/t.length),e};return angular.forEach(e,function(e){var n=e.key;angular.forEach(t,function(t){var a=!1;if(angular.isFunction(t.keys)?t.keys(n)&&(a=!0):-1!==t.keys.indexOf(n)&&(a=!0),a){if("pie"===t.type)switch(e.type){case"counter":e.values=[r(e.values)];break;case"average":e.values=[s(e.values)];break;case"gauge":var o=e.values[e.values.length-1];e.values=[o]}t.data.push(e)}})}),angular.forEach(t,function(t){delete t.keys}),t}function s(t,n,s){s=s||e.interval;var o={date:n,interval:s},i=a(t,o);return i.then(function(e){var n={title:"CPU监控",keys:["cpu.busy","cpu.iowait"]},a={title:"内存监控",data:[],keys:["mem.used","mem.usageRate"]},o={title:"process",keys:["procs_blocked","procs_running"]},i={title:"tcp/udp",keys:["tcp","udp"]},u={title:"网络状况",keys:function(t){var e=/\S*?\.(receive|transmit)\.(kbytes|rate|packets|errs|drop)/;return e.test(t)}},c={title:"磁盘状况",keys:function(t){var e=/\S*?\.(read\-times|write\-times|ms\-reading|ms\-writing|writeSpeed|available)/;return e.test(t)}},l=[n,a,o,i,u,c];e.data=r(l,e.data,t,s)}),i}function o(t,n,s){s=s||e.interval;var o={date:n,interval:s},i=a(t,o);return i.then(function(e){var n={title:"backgroundFlushing",keys:["bgFlushing.flushes","bgFlushing.average_ms","bgFlushing.total_ms"]},a={title:"connections",keys:["connections.current","connections.totalCreated"]},o={title:"globalLock",keys:["globalLock.lockTime","globalLock.currentQueue.total","globalLock.currentQueue.readers","globalLock.currentQueue.writers","globalLock.activeClients.total","globalLock.activeClients.readers","globalLock.activeClients.writers"]},i={title:"indexCounters",keys:["indexCounters.accesses","indexCounters.hits","indexCounters.misses","indexCounters.missRatio"]},u={title:"network",keys:["network.outkb","network.inkb","network.numRequests"]},c={title:"opcounters",keys:["opcounters.query","opcounters.update","opcounters.delete","opcounters.insert","opcounters.getmore","opcounters.command"]},l={title:"recordStats",keys:["recordStats.accessesNotInMemory","recordStats.pageFaultExceptionsThrown"]},v={title:"mem",keys:["mem.virtual","mem.resident"]},g=[n,a,o,i,u,c,l,v],d=0;angular.forEach(g,function(t){d+=t.keys.length});var f=0;angular.forEach(e.data,function(t){t.key;f++}),e.data=r(g,e.data,t,s)}),i}function i(){var e=t.get("/stats/servers");return e}var u={getServerStats:s,getMongodbStats:o,getServers:i,get:a,format:"json"};return u}var e=angular.module("jtApp");e.constant("STATS_SETTING",{interval:60,gap:40}),e.factory("stats",t),t.$inject=["$http","STATS_SETTING"]}(this);