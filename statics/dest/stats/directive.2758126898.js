!function(){"use strict";function t(t,a){return{restrict:"E",link:function(n,i,e){function r(t){var a=[];angular.forEach(t,function(t){angular.forEach(t.values,function(t){a.push(t.t)})}),a.sort();var n=-1,i=[];return angular.forEach(a,function(t){t!==n&&(i.push(t),n=t)}),i}function c(t){var n=r(t),i=[];angular.forEach(t,function(t){var e=[];angular.forEach(t.values,function(t){var i=a.binaryIndexOf(n,t.t);-1!==i&&(e[i]=t.v)}),e.unshift(t.key),i.push(e)});var e=["x"];return angular.forEach(n,function(t){e.push(1e3*t)}),i.unshift(e),i}function o(t){var a=g.currentPage+t;if(0===a||a===g.maxPage+1)return 0===a&&g.prevBtn.addClass("hidden"),void(a===g.maxPage+1&&g.nextBtn.addClass("hidden"));g.prevBtn.removeClass("hidden"),g.nextBtn.removeClass("hidden");var n=s(a);g.chart.load(n),g.currentPage=a}function u(){var t='<div class="prev"><i class="glyphicon glyphicon-menu-left"></i></div>',a='<div class="next hidden"><i class="glyphicon glyphicon-menu-right"></i></div>',n=angular.element(t).on("click",function(){o(-1)}),e=angular.element(a).on("click",function(){o(1)});i.append(n).append(e),g.prevBtn=n,g.nextBtn=e}function l(t){return Math.floor(i.prop("clientWidth")/t)}function s(t){var a=[],n=g.showPointsCount,i=-(g.maxPage-t)*n,e=i-n;return 0===i&&(i=void 0),angular.forEach(g.data,function(t){var n=t[0],r=t.slice(e,i);n!==r[0]&&r.unshift(n),a.push(r)}),{x:"x",columns:a}}function h(a){g.data=c(a.data),g.gap=a.gap||t.gap,g.showPointsCount=l(g.gap);var n=g.data[0].length;g.maxPage=Math.ceil(n/g.showPointsCount),g.currentPage=g.maxPage;var i=s(g.maxPage);i.type=a.type;var e=a.interval||t.interval;n>g.showPointsCount&&u();var r="%Y-%m-%d %H:%M:%S";e%24*3600===0?r="%Y-%m-%d":e%3600===0?r="%Y-%m-%d %H":e%60===0&&(r="%Y-%m-%d %H:%M"),setTimeout(function(){g.chart=c3.generate({bindto:p[0],data:i,axis:{x:{type:"timeseries",tick:{format:r}}}})},0)}function d(t){var a=[];angular.forEach(t.data,function(t){var n=t.values[0].v;a.push([t.key,n])}),setTimeout(function(){g.chart=c3.generate({bindto:p[0],data:{columns:a,type:"pie"}})},0)}function f(t){t.title&&v.eq(0).html(t.title),"pie"!==t.type?h(t):d(t)}i.html('<h3 class="title text-center"></h3><div class="chartContainer"></div>');var v=i.children(),p=v.eq(1),g={data:null,gap:null,chart:null,maxPage:null,showPointsCount:null};n.$watch(e.jtData,function(t){t&&f(t)},!0)}}}function a(t,a){return{restrict:"E",link:function(n,i,e){function r(){i.html('<div class="alert alert-info"><i class="glyphicon glyphicon-time"></i>正在加载中，请稍候...</div>')}function c(){var a=l(n),e=[];angular.forEach(a.data,function(t,a){var n="col-xs-12";"pie"===t.type&&(n="col-xs-4"),e.push('<jt-chart class="jtChart '+n+'" jt-data="stats.charts.data['+a+']"></jt-chart>')}),i.html(e.join("")),t(i.children())(n)}function o(){var t=l(n);i.html('<div class="alert alert-danger"><i class="glyphicon glyphicon-exclamation-sign"></i>'+t.error+"</div>")}var u=e.jtData,l=a(u);n.$watch(u+".status",function(t){switch(t){case"loading":r();break;case"success":c();break;case"error":o()}},!0)}}}var n=angular.module("jtApp");n.directive("jtChart",t),t.$inject=["STATS_SETTING","utils"],n.directive("jtCharts",a),a.$inject=["$compile","$parse"]}(this);